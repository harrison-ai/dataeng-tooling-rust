# This workflow automatically builds and publishes the docker image
# for every push to the `main` branch. We rely on branch protection
# to ensure that all changes to `main` have gone through a PR, and
# on the separate `tests` workflow to ensure that every PR properly
# increments the version info in a way that's safe to publish.

name: Publish docker images from main

on:
  push:
    branches:
      - main

jobs:
  publish:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      - name: Log in to Docker Hub
        uses: docker/login-action@1edf6180e07d2ffb423fc48a1a552855c0a1f508
        with:
          username: ${{ secrets.DOCKER_USERNAME }}
          password: ${{ secrets.DOCKER_PASSWORD }}
      
      - name: Build and publish the images
        run: make publish
